# ビルドエラー解消および機能復元ロードマップ

## 現状の課題
1.  **Android SDK不整合**: 一部の依存プラグインが Android API 36 を要求しており、現在の設定（API 34）ではビルドが失敗する。
2.  **ワークフローの機能不足**: 新しく導入された `android_build.yml` に、過去の `web_apk_build.yml` で実装されていた「自動バージョン管理」と「セルフアップデート用ファイルの自動配信」が含まれていない。

## フェーズ1：Androidビルドの正常化（即時対応）
このフェーズでは、まずGitHub Actions上でビルドが正常に完了する状態を作ります。

*   [x] **compileSdk/targetSdkの更新**: `android/app/build.gradle.kts` を API 36/35 に更新（実施済み）。
*   [ ] **Kotlin Gradle Pluginの確認**: 必要に応じて Kotlin バージョンを更新する（ビルドログで警告が出る場合）。
*   [ ] **CI環境の検証**: GitHub Actionsのランナー環境（SDKの自動インストール）でAPI 36が正しく動作するか確認する。

## フェーズ2：過去の「自動化ロジック」の復元
失われたセルフアップデート機能を、新しいビルド環境に合わせて統合します。

*   [ ] **自動バージョン管理の統合**: 
    *   `web_apk_build.yml` にあった `.version_counter` を用いた `versionCode` の自動生成ロジックを `android_build.yml` に移植。
*   [ ] **アップデート情報の自動作成（version.json）**:
    *   ビルド完了後、最新のタグ名、ダウンロードURL、リリースノートを含む `version.json` を生成するステップを `android_build.yml` に追加。
*   [ ] **デプロイ機能の集約**:
    *   生成された `version.json` を GitHub Pages に自動デプロイするステップを追加。これによりアプリ側からのアップデート検知を正常化させる。

## フェーズ3：アプリ側との整合性確認
ビルドされたバイナリが正しく動作し、アップデートが機能するかを検証します。

*   [ ] **リリースノートの動的取得**: `git log` からのリリースノート自動生成の復元。
*   [ ] **環境変数の再確認**: `.env` （Supabaseキー等）がGitHub Secretsから正しく注入されているか、リリースビルドで動作確認。
*   [ ] **テスト実行**: CIワークフロー (`ci.yml`) との同期。

## 完了定義
*   GitHub Actionsで `apk` がエラーなく生成される。
*   生成と同時にGitHub Releaseが作成され、成果物がアップロードされる。
*   GitHub Pages上の `version.json` が最新の状態に更新され、アプリから新しいバージョンとして認識される。
